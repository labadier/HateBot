name: Build and Deploy HateSpeech Detection Model

on: 
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build-deploy:
    name: Build and Deploy Model
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code #copy code from repo to runner
        uses: actions/checkout@v4 

      # - name: Set Test environment   #for maven
      #   run: |
      #     pip install -r requirements.txt 
      #     pip install pytest pytest-ordering
          
      # - name: Unit Tests
      #   run: |
      #     pytest --maxfail=1 --disable-warnings -q tests/
      
      - name: Login to Docker Hub
        uses: docker/login-action@v3
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_HUB_ACCESS_TOKEN }}
          registry: docker.io

      - name: Build Training Image
        uses: docker/build-push-action@v6
        with:
          context: .
          dockerfile: Dockerfile.train
          push: true
          tags: ${{ secrets.DOCKER_USERNAME }}/hatespeech-detection-training:latest

      - name: Build Inference Image
        uses: docker/build-push-action@v6
        with:
          context: inference
          dockerfile: Dockerfile
          push: true
          tags: ${{ secrets.DOCKER_USERNAME }}/hatespeech-detection-inference:latest

